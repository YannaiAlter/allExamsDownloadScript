//Made by Yannai Alter
var tables = document.getElementsByTagName("table");
var coursesTable = tables[4];
var allCourses = coursesTable.getElementsByTagName("tr");
var linksArray =[];
var courseNumbers=[];
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
function getSourceAsDOM(url)
{
    xmlhttp=new XMLHttpRequest();
    xmlhttp.open("GET",url,false);
    xmlhttp.send();
    parser=new DOMParser();
    return parser.parseFromString(xmlhttp.responseText,"text/html");      
}

for(var a =1; a<allCourses.length;a++) // looping all courses and searching for the "sheelon" and "mahberet-bhina"
{
    var course1 = allCourses[a].getElementsByTagName("td")[1];
    courseNumbers.push(allCourses[a].getElementsByTagName("td")[8].innerText);
    
    var course1link = course1.getElementsByTagName("a")[0].href;
    course1link = course1link.replace("course_info.courseinfo?","course_info_2.ZIUNMATALA?");
    var course1page = getSourceAsDOM(course1link);

    for(var i=0; i<course1page.links.length;i++)
    {
    if(course1page.links[i].text == "שאלון אישי" || course1page.links[i].text == "קישור לשאלון") linksArray.push(course1page.links[i].href);
      if(course1page.links[i].text == "קובץ בחינה סרוק") linksArray.push(course1page.links[i].href);
    }
}
var a;

var i = 0;                     //  set your counter to 1

function myLoop () {           //  create a loop function
   setTimeout(function () {    //  call a 500ms setTimeout when the loop is called
     a = document.createElement('a');
    a.setAttribute('href',linksArray[i]);
    a.setAttribute('download',courseNumbers[i]);
    a.innerHTML = "ddd";//why the hell did i do this?
    // apend the anchor to the body
    // of course you can append it almost to any other dom element
    a.click();
      i++;                     //  increment the counter
      if (i < linksArray.length) {            //  if the counter < 10, call the loop function
         myLoop();             //  ..  again which will trigger another 
      }                        //  ..  setTimeout()
   }, 700)
}
myLoop();